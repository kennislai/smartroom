<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Title of the document</title>
    <script src="/static/js/jquery-1.11.3.min.js"></script>
	<script src="/static/js/socket.io.js"></script>
    <script type="text/javascript">
 		var socket = io.connect('http://127.0.0.1:8088');
 		socket.on('connect', function(data){
 			
 		});

 		socket.on('data', function(data){
			alert(data);
 		});

        var deviceCodeAndName = {
            DR_DND: "Do Not Disturb",
            DR_LAU: "Laundry",
            DR_MAK: "Makeup Room"
        }

        socket.emit('monitorRequest','');

        socket.on('monitorResponse', function (message) {
            //alert("message come");
            //var content = document.getElementById('content');
            //content.innerHTML += message.data + "<br/>";
            var jsonObj = JSON.parse(message);
            
            var table = document.getElementById('monitorTable');

            var roomTable = document.getElementById(jsonObj.RoomNumber);

            if (roomTable == null){
                var row = table.insertRow(table.rows.length);
                var cell = row.insertCell(0);
                
                var content = "<table id='" + jsonObj.RoomNumber + "' border='1'><tr><th colspan='2'>" + jsonObj.RoomNumber + "</th></tr>";
                content += "<tr><td id='" + jsonObj.RoomNumber + jsonObj.DeviceCode + "'>" + deviceCodeAndName[jsonObj.DeviceCode] + "</td>";
                content += "<td id='" + jsonObj.RoomNumber + jsonObj.DeviceCode + "Value'>" + changeColor(jsonObj.Value) + "</td></tr>";
                content += "</table>";

                cell.innerHTML = content;
            }else{
                var roomType = document.getElementById(jsonObj.RoomNumber + jsonObj.DeviceCode);
                if (roomType == null){
                    var row = roomTable.insertRow(roomTable.rows.length);
                    var typeCell = row.insertCell(0);
                    var valueCell = row.insertCell(1);
                    
                    typeCell.id = jsonObj.RoomNumber + jsonObj.DeviceCode;
                    typeCell.innerHTML = deviceCodeAndName[jsonObj.DeviceCode];

                    valueCell.id = jsonObj.RoomNumber + jsonObj.DeviceCode + "Value";
                    valueCell.innerHTML = changeColor(jsonObj.Value);
                }else{
                    var valueCell = document.getElementById(jsonObj.RoomNumber + jsonObj.DeviceCode + "Value");
                    valueCell.innerHTML = changeColor(jsonObj.Value);
                }
            }

        });

        function changeColor(value){
            if(value == "On")
                return "<font color='red'>" + value + "</font>";
            else
                return value;
        }
    </script>
</head>

<body>
    <table id="monitorTable" border="1">
        <tr id="header">
            <th colspan="5">Room Monitor</th>
        </tr>
    </table>
    <hr />
    <div id="content" />
</body>
</html>